@model Property
@{
    ViewData["Title"] = "Ingatlan részletei";
}

<h1>Ingatlan részletei</h1>

<p>
    <a asp-action="Index" class="btn btn-secondary">Vissza a listához</a>
</p>

<div class="card">
    <div class="card-body">
        <h3 class="card-title">@Model.Cim</h3>
        <h5 class="card-subtitle mb-2 text-muted">
            @Model.Category – @Model.ListingType
        </h5>

        <p class="card-text">
            <strong>Alapterület:</strong> @Model.Alapterulet m²<br />
            <strong>Szobaszám:</strong> @Model.Szobaszam<br />
            <strong>Ár:</strong> @string.Format("{0:N0}", Model.Ar) Ft<br />
            <strong>Állapot:</strong> @Model.Allapot<br />
            <strong>Emelet:</strong> @(Model.Emelet?.ToString() ?? "n/a")<br />
            <strong>Építés éve:</strong> @(Model.EpitesEve?.ToString() ?? "n/a")<br />
            <strong>Fűtés típusa:</strong> @Model.Futestipus<br />
            <strong>Létrehozva:</strong> @Model.Letrehozva.ToLocalTime().ToString("yyyy.MM.dd HH:mm")<br />
        </p>

        @if (!string.IsNullOrWhiteSpace(Model.Leiras))
        {
            <h5>Leírás</h5>
            <p>@Model.Leiras</p>
        }

        <!-- Tulajdonos adatai (ha be van tölteve a navigációs property) -->
        @if (Model.TulajdonosUser != null)
        {
            <h5>Hirdető</h5>
            <p>
                @Model.TulajdonosUser.UserName<br />
                @Model.TulajdonosUser.Email
            </p>
        }
    </div>

    @if (Model.Kepek != null && Model.Kepek.Any())
    {
        <h5>Képek</h5>
        <div class="row">
            @foreach (var img in Model.Kepek)
            {
                <div class="col-md-3 mb-3 text-center">
                    <!--
                        A képre kattintva megnyitunk egy Bootstrap modalt,
                        benne ugyanezzel a képpel nagy méretben.
                        data-bs-toggle="modal" + data-bs-target="#imageModal" -> ez nyitja a modalt
                        data-img-src -> ide tesszük a nagy kép útvonalát, a JS innen olvassa ki
                    -->
                    <img src="@img.ImagePath"
                         class="img-fluid img-thumbnail mb-2 img-clickable"
                         alt="Ingatlan kép"
                         data-bs-toggle="modal"
                         data-bs-target="#imageModal"
                         data-img-src="@img.ImagePath" />

                    @* Ha megmaradt a kép törlés form, az maradhat itt alatta *@
                    @if (ViewBag.CanEdit == true)
                    {
                        <form asp-action="DeleteImage" method="post" class="d-inline">
                            <input type="hidden" name="imageId" value="@img.Id" />
                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('Biztosan törlöd ezt a képet?');">
                                Kép törlése
                            </button>
                            @Html.AntiForgeryToken()
                        </form>
                    }

                </div>
            }
        </div>
    }



</div>

@if (ViewBag.CanEdit == true)
{
    <p class="mt-3">
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">Szerkesztés</a>
        <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-danger">Törlés</a>
    </p>
}


<!--
    Bootstrap modal, amelyben a kattintott kép nagyban jelenik meg.
    A #imageModal id-val hivatkozunk rá az img data-bs-targetjén keresztül.
-->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-body text-center">
                <!--
                    Ebbe az <img>-be tesszük bele a kattintott kép forrását (src).
                    Alapértelmezett src lehet üres, a JS fogja beállítani.
                -->
                <img id="imageModalImg" src="" class="img-fluid" alt="Nagyított kép" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bezárás</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Ez a script gondoskodik arról, hogy kattintáskor a megfelelő kép kerüljön a modalba.
        document.addEventListener("DOMContentLoaded", function () {

            // Megkeressük az összes olyan képet, amin van img-clickable osztály
            var clickableImages = document.querySelectorAll(".img-clickable");
            var modalImg = document.getElementById("imageModalImg");

            clickableImages.forEach(function (img) {
                img.addEventListener("click", function () {
                    // A data-img-src attribútumból kiolvassuk a nagy kép elérési útját
                    var src = img.getAttribute("data-img-src");
                    // Beállítjuk a modal képen
                    modalImg.setAttribute("src", src);
                });
            });
        });
    </script>
}

